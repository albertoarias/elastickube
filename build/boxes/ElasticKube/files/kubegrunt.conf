#!upstart
description "ElasticKube Grunt"

setuid vagrant

start on runlevel [2345]
stop  on shutdown

respawn
respawn limit unlimited

script
     # Run npm install
    cd /opt/elastickube/src/ui
    npm install

    cd /opt/elastickube/build/kubegrunt
    npm install

    # Start services
    cd /opt/elastickube/src/ui
    npm start > /var/log/elastickube/ui.log &

    # Build documentation
    export PYTHONPATH=/opt/elastickube/src
    sphinx-autobuild -b dirhtml /opt/elastickube/docs /opt/elastickube/src/build/documentation &

    # Launch Grunt
    cd /opt/elastickube/build/kubegrunt
    grunt > /var/log/elastickube/build.log &

    wait
end script

